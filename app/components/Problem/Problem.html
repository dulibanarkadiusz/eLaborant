<div ng-controller="ProblemCtrl" ng-init="getProblem()">
    <div class="panel panel-default" ng-repeat="x in problemData">
        <div class="panel-heading">

            <h3 class="problem-title">
                Problem #{{problemid}}
                <span class="problemOptions">
                    <button class="btn btn-md btn-default neutral-button" ng-click="openRemoveProblemWindow()" data-placement="right" data-original-title="Usuń problem" bs-tooltip>
                        <i class="fa fa-trash pull-right" aria-hidden="true"></i>
                    </button>   
                </span>
            </h3>

            <div class="pull-right">
                <div class="problemStatusInfo">
                    <div>
                        <small>Rozwiązany?</small>
                    </div>
                    <label class="switch">
                        <input type="checkbox" ng-model="x.isResolved" ng-change="editEntity(x.id, x.isResolved)">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

        </div>

        <div class="problem-details">
            <div ng-hide="problemDataLoaded || errorDataLoaded!=''" class="preloader">
            </div>

            <div ng-bind-html="errorDataLoaded"></div>

            <div class="row">
                <div class="col-xs-4 col-md-3 col-lg-2 textToRight">
                    Lokalizacja:
                </div>
                <div class="col-xs-8 col-md-3">
                     <a ng-if="x.computer" ui-sref="Komputer({id: '{{x.computer.id}}'})" title="Lokalizacja komputera: {{x.computer.laboratory.building + x.computer.laboratory.roomNo}}" bs-tooltip>
                        <i class="fa fa-desktop"></i> {{x.computer.name}}
                    </a>
                    <a ng-if="x.laboratory" ui-sref="Laboratorium({id: '{{x.laboratory.id}}'})"> 
                        <i class="fa fa-cube"></i> {{x.laboratory.building + x.laboratory.roomNo}}
                    </a>
                </div>
                <div class="col-xs-4 col-md-2 textToRight">
                    Autor:
                </div>
                <div class="col-xs-8 col-md-4 col-lg-5">
                    {{x.author.firstname}} {{x.author.surname}}
                </div>
            </div>
            <div class="row">
                <div class="col-xs-4 col-md-3 col-lg-2 textToRight">
                    Data zgłoszenia:
                </div>
                <div class="col-xs-8 col-md-3">
                    <time am-time-ago="x.dateNotification" class="badge" title="Zgłoszony: {{ x.dateNotification | amDateFormat: 'dddd, D MMMM YYYY H:mm' }}" bs-tooltip>
                        {{x.dateNotification | amDateFormat: 'dddd, D MMMM YYYY H:mm '}}
                    </time>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-4 col-md-3 col-lg-2 textToRight">
                    Opis problemu:
                </div>
                <div class="col-xs-8 col-md-9">
                     {{x.content}}
                </div>
            </div>
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8"></div>
            </div>

        </div>
    </div>
    <div id="task-list" ng-controller="TaskCtrl" ng-show="problemDataLoaded" ng-init="getList(0, problemId)" class="panel panel-default">
        <div class="panel-heading">
            <h4>
                Zadania
                <button class="btn btn-success btn-sm pull-right" title="Nowe zadanie" ng-click="openNewTaskWindow()">
                    <i class="fa fa-plus" aria-hidden="true"></i> Dodaj nowe zadanie
                </button>
            </h4>
        </div>


        <div ng-include="'app/components/Task/TasksListPartialView.html'"></div>
        <!--
        <div class="task">
            <div class="panel-body panel-task" ng-repeat="task in taskData">
                <div class="row">
                    <div class="col-xs-1 cols-sm-1 col-md-1">
                        <span class="label {{task.priority | labelPriority}}" title="Priorytet zadania: {{task.priority}}">{{task.priority}}</span>
                    </div>
                    <div class="col-xs-4 col-sm-4 col-md-3">
                        <div title="Zadanie dodano: {{task.dateNotification | amDateFormat: 'dddd, D MMMM YYYY H:mm' }}">
                            <i class="fa fa-clock-o" aria-hidden="true"></i> {{task.dateNotification | amDateFormat: 'D MMMM YYYY H:mm '}}
                        </div>
                        <div title="Termin realizacji upływa: {{task.dateRealization | amDateFormat: 'dddd, D MMMM YYYY H:mm' }}">
                            <i class="fa fa-bell-o" aria-hidden="true"></i> {{task.dateRealization | amDateFormat: 'D MMMM YYYY H:mm '}}
                        </div>
                    </div>
                    <div class="col-xs-3 col-sm-3 col-md-2">
                        <a ng-show="task.userExecuteTasksById.length>0" data-toggle="modal" role="button" title="Kliknij, by przejrzeć listę" data-target="#addUser-{{task.id}}">
                            <i title="{{task.executorsString}}" bs-tooltip><span class="badge">{{task.userExecuteTasksById.length}} wykonuje</span></i>
                        </a>
                    </div>
                    <div class="col-xs-4 col-sm-4 col-md-3" title="Bieżący status: {{task.state}}"> 
                        <i class="fa fa-flag"></i> {{task.state}}
                    </div>
                    <div class="col-xs-4 col-sm-4 col-md-2" title="Zadanie dodane przez: {{task.author.firstname + ' ' + task.author.surname}}">
                        <b><i class="fa fa-user-plus"></i> {{task.author.firstname + " " + task.author.surname}}</b>
                    </div>
                    
                    <div class="textToRight col-xs-3 col-sm-3 col-md-1 task-buttons no-collapsable pull-right">
                        <button class="btn btn-warning btn-xs" data-toggle="modal" data-target="#editProblemModal" title="Edytuj zadanie" ng-click="openEditTaskWindow(task.id)">
                            <i class="fa fa-pencil" aria-hidden="true"></i>
                        </button>
                        <button class="btn btn-danger btn-xs" data-toggle="modal" data-target="#editProblemModal" title="Usuń zadanie" ng-click="openRemoveTaskWindow(task.id)">
                            <i class="fa fa-trash-o" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 task-content">
                        {{task.content}}
                    </div>
                </div>
                <div class="modal fade" id="addUser-{{task.id}}" role="dialog">
                    <div class="modal-dialog modal-md">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Wykonawcy zadania #{{task.id}}</h4>
                            </div>
                            <div class="modal-body">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Imię i nazwisko laboranta</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="executor in task.userExecuteTasksById">
                                            <td>{{ executor.firstname }} {{ executor.surname }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <p class="textToRight">Łącznie: {{task.userExecuteTasksById.length | executorsIntToString}}</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="row pagination-container" ng-show="tasksCount > 0">
                <div class="col-xs-12 col-sm-9">
                    <br>
                    <ul class="pagination">
                        <li ng-class="currentPage==0 ? 'disabled' : ''">
                            <a href="#" ng-click="getList(currentPage - 1)">«</a>
                        </li>
                        <li ng-repeat="x in pages" ng-class="x==currentPage ? 'active' : 'active2'">
                            <a href="#" ng-click="getList(x)">{{x+1}}</a>
                        </li>
                        <li ng-class="(currentPage==pages.length-1) ? 'disabled' : ''">
                            <a href="#" ng-click="(currentPage==pages.length-1) ? null : getList(currentPage + 1)">»</a>
                        </li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 form-group paginationPageSize">
                    Wyników na stronę:<br>
                    <select class="form-control" ng-model="pageSize" ng-change="loadTasks(0)" ng-options="v for v in [5,10,25,50,100]">
                    </select>
                </div>
            </div>
            <div class="row infoMessage">
                {{ message }}
            </div>
            -->
        </div>
    </div>
</div>

<script>
        $('[data-toggle="tooltip"]').tooltip();   
</script>